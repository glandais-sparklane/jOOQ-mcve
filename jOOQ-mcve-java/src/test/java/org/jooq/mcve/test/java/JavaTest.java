package org.jooq.mcve.test.java;

import org.jooq.CreateTableColumnStep;
import org.jooq.DSLContext;
import org.jooq.InsertValuesStepN;
import org.jooq.conf.SettingsTools;
import org.jooq.conf.StatementType;
import org.jooq.impl.DSL;
import org.jooq.impl.SQLDataType;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import java.sql.Connection;
import java.sql.DriverManager;
import java.util.List;
import java.util.Locale;

import static org.jooq.impl.DSL.field;
import static org.jooq.impl.DSL.table;

public class JavaTest {

    static {
        Locale.setDefault(Locale.FRANCE);
    }

    public Connection connection;
    public DSLContext ctx;

    @Before
    public void setup() throws Exception {
        connection = DriverManager.getConnection("jdbc:sqlite::memory:");
        ctx = DSL.using(connection, SettingsTools.defaultSettings().withStatementType(StatementType.STATIC_STATEMENT));
    }

    @After
    public void after() throws Exception {
        ctx = null;
        connection.close();
        connection = null;
    }

    @Test
    public void mcveTest() {
        ctx.createTable("test")
                .column(field("id", SQLDataType.INTEGER))
                .column(field("value1", SQLDataType.DOUBLE))
                .column(field("value2", SQLDataType.DOUBLE))
                .execute();

        InsertValuesStepN<?> insert = ctx.insertInto(table("test"), List.of(field("id"), field("value1"), field("value2")));
        for (int i = 0; i < 10; i++) {
            insert = insert.values(List.of(i + 100, (14.5 * i), (Math.PI * i)));
        }
        insert.execute();
    }
}
